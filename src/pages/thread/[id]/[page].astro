---
import ThreadView from "../../../components/ThreadView.astro";
import { getThreadById } from "../../../lib/data";
import { parsePageParam } from "../../../lib/pagination";

export async function getStaticPaths() {
  const { getAllThreads } = await import("../../../lib/data");
  const allThreads = getAllThreads();
  const paths: Array<{ params: { id: string; page: string } }> = [];
  for (const thread of allThreads) {
    const totalPages = Math.ceil(thread.reply_num / 30);
    if (totalPages > 1) {
      for (let p = 2; p <= totalPages; p++) {
        paths.push({ params: { id: thread.id.toString(), page: p.toString() } });
      }
    }
  }
  return paths;
}

const { id, page } = Astro.params;
const threadId = parseInt(id!);
const currentPage = parsePageParam(page);
const thread = getThreadById(threadId);
if (!thread) return Astro.redirect("/404");
---

<ThreadView thread={thread} threadId={threadId} currentPage={currentPage} title={`${thread.title} - 第${currentPage}页 - fursuit吧·档案馆与时间机器：为了无法忘却的往事`} />